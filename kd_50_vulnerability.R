vulnerability_summary <- fread("Results/vulnerability_summary.tsv.gz")

vulnerability_summary %>% 
	inner_join(
		(median_melted_results %>% 
		 	select(Pathway, unique_name) %>% 
		 	unique)) %>%
	filter(vuln.p < 0.05) %>%
	mutate(Pathway = case_when(
		Pathway == "Ribosome" ~ "Ribosome",
		Pathway == "LOS" ~ "LOS",
		unique_name %like% "nuo" ~ "NDH-1",
		Pathway %like% "Cell Wall" ~ "PG/Division")) %>%
	mutate(Pathway = factor(Pathway, levels = c("Ribosome", "PG/Division", "NDH-1", "LOS"))) %>%
	filter(!is.na(Pathway)) %>%
	filter(condition %in% c("None_0_T1 - None_0_T0", "None_0_T2 - None_0_T0")) %>%
	mutate(condition = case_when(
		condition == "None_0_T1 - None_0_T0" ~ "T1",
		condition == "None_0_T2 - None_0_T0" ~ "T2")) %>%
	mutate(condition = factor(condition)) %>%
	ggplot() +
	geom_boxplot(
		alpha = 0.75,
		show.legend = FALSE,
		aes(condition, vuln.est, fill = interaction(condition, Pathway))) +
	facet_wrap(~Pathway, ncol = 1) +
	scale_fill_manual(
		values = c(
			"T1.Ribosome" = "#FB9A99", 
			"T2.Ribosome" = "#E31A1C",
			"T1.NDH-1" = "#CAB2D6",
			"T2.NDH-1" = "#6A3D9A",
			"T1.LOS" = "#B2DF8A",
			"T2.LOS" = "#33A02C",
			"T1.PG/Division" = "#FDBF6F",
			"T2.PG/Division" = "#FF7F00")) +
	doc_theme



#t-test
vulnerability_summary %>% 
	inner_join(median_melted_results %>% select(Pathway, unique_name) %>% unique) %>%
	filter(vuln.p < 0.05) %>%
	mutate(Pathway = case_when(
		Pathway == "Ribosome" ~ "Ribosome", 
		Pathway == "LOS" ~ "LOS",
		unique_name %like% "nuo" ~ "NDH-1",
		Pathway %like% "Cell Wall" ~ "PG/Division")) %>%
	mutate(Pathway = factor(Pathway, levels = c("Ribosome", "PG/Division", "NDH-1", "LOS"))) %>%
	filter(!is.na(Pathway)) %>%
	filter(condition %in% c("None_0_T1 - None_0_T0", "None_0_T2 - None_0_T0")) %>%
	mutate(condition = case_when(
		condition == "None_0_T1 - None_0_T0" ~ "T1",
		condition == "None_0_T2 - None_0_T0" ~ "T2")) %>% 
	group_by(Pathway, condition) %>% select(vuln.est)  %>% 
	nest %>% 
	pivot_wider(id_cols = Pathway, names_from = condition, values_from = data) %>%
	mutate(p_value = wilcox.test(unlist(T1), unlist(T2))$p.value,
				 t_value = wilcox.test(unlist(T1), unlist(T2))$statistic)


################################################################
################################################################

vulnerability_summary %>% 
	inner_join((median_melted_results %>% select(Pathway, unique_name) %>% unique)) %>%
	filter(vuln.p < 0.05) %>%
	mutate(Pathway = case_when(
		Pathway == "Ribosome" ~ "Ribosome",
		Pathway == "LOS" ~ "LOS",
		unique_name %like% "nuo" ~ "NDH-1",
		Pathway %like% "Cell Wall" ~ "PG/Division")) %>%
	mutate(Pathway = factor(Pathway, levels = c("Ribosome", "PG/Division", "NDH-1", "LOS"))) %>%
	filter(!is.na(Pathway)) %>%
	filter(condition %in% c("None_0_T1 - None_0_T0", "None_0_T2 - None_0_T0")) %>%
	mutate(condition = case_when(
		condition == "None_0_T1 - None_0_T0" ~ "T1",
		condition == "None_0_T2 - None_0_T0" ~ "T2")) %>%
	mutate(condition = factor(condition)) %>%
	ggplot() +
	geom_boxplot(
		alpha = 0.75,
		show.legend = FALSE,
		aes(condition, vuln.kd_50, fill = interaction(condition, Pathway))) +
	facet_wrap(~Pathway, ncol = 1) +
	scale_fill_manual(
		values = c(
			"T1.Ribosome" = "#FB9A99", 
			"T2.Ribosome" = "#E31A1C",
			"T1.NDH-1" = "#CAB2D6",
			"T2.NDH-1" = "#6A3D9A",
			"T1.LOS" = "#B2DF8A",
			"T2.LOS" = "#33A02C",
			"T1.PG/Division" = "#FDBF6F",
			"T2.PG/Division" = "#FF7F00")) +
	doc_theme


vulnerability_summary %>% 
	inner_join(median_melted_results %>% select(Pathway, unique_name) %>% unique) %>%
	filter(vuln.p < 0.05) %>%
	mutate(Pathway = case_when(
		Pathway == "Ribosome" ~ "Ribosome", 
		Pathway == "LOS" ~ "LOS",
		unique_name %like% "nuo" ~ "NDH-1",
		Pathway %like% "Cell Wall" ~ "PG/Division")) %>%
	mutate(Pathway = factor(Pathway, levels = c("Ribosome", "PG/Division", "NDH-1", "LOS"))) %>%
	filter(!is.na(Pathway)) %>%
	filter(condition %in% c("None_0_T1 - None_0_T0", "None_0_T2 - None_0_T0")) %>%
	mutate(condition = case_when(
		condition == "None_0_T1 - None_0_T0" ~ "T1",
		condition == "None_0_T2 - None_0_T0" ~ "T2")) %>% 
	group_by(Pathway, condition) %>% select(vuln.kd_50)  %>% 
	nest %>% 
	pivot_wider(id_cols = Pathway, names_from = condition, values_from = data) %>%
	mutate(p_value = wilcox.test(unlist(T1), unlist(T2))$p.value,
				 t_value = wilcox.test(unlist(T1), unlist(T2))$statistic)
